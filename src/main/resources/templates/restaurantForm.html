<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Restaurant - StreetFoodGo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background-color: #f8f9fa; min-height: 100vh; padding: 2rem 0; }
        .form-container {
            max-width: 50rem; /* Λίγο πιο πλατύ για να χωράει το table */
            width: 100%;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: auto;
        }
        .btn-primary-custom {
            background-color: #dc2626;
            border-color: #dc2626;
            color: white;
        }
        .btn-primary-custom:hover {
            background-color: #b91c1c;
            color: white;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="form-container">

        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="mb-0" th:text="${restaurant.id == null} ? 'Add New Restaurant' : 'Edit Restaurant'">Title</h2>
            <a th:href="@{/owner/dashboard}" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Back</a>
        </div>

        <form th:action="@{${restaurant.id == null ? '/owner/restaurant/new' : '/owner/restaurant/' + restaurant.id + '/edit'}}"
              th:object="${restaurant}"
              method="post"
              class="mb-5">

            <input type="hidden" th:field="*{id}">

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Name</label>
                    <input type="text" th:field="*{name}" class="form-control" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Address</label>
                    <input type="text" th:field="*{address}" class="form-control" required>
                </div>
                <div class="col-md-2 mb-3">
                    <label class="form-label fw-bold">Zip Code</label>
                    <input type="text" th:field="*{zipCode}" class="form-control" placeholder="12345">
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Min Order (€)</label>
                    <input type="number" step="0.5" th:field="*{minimumOrderAmount}" class="form-control" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Delivery Fee (€)</label>
                    <input type="number" step="0.1" th:field="*{deliveryFee}" class="form-control" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="form-label fw-bold">Service Type</label>
                    <select th:field="*{serviceType}" class="form-select" required>
                        <option th:each="type : ${serviceTypes}" th:value="${type}" th:text="${type}"></option>
                    </select>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label fw-bold d-block">Cuisines</label>
                <div class="d-flex flex-wrap gap-3">
                    <div class="form-check" th:each="cuisine : ${cuisines}">
                        <input class="form-check-input" type="checkbox" th:field="*{cuisines}" th:value="${cuisine}">
                        <label class="form-check-label" th:for="${#ids.prev('cuisines')}" th:text="${cuisine}"></label>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <h5 class="mb-3">Operating Hours</h5>
                <div class="table-responsive">
                    <table class="table table-sm table-borderless align-middle">
                        <thead>
                        <tr>
                            <th style="width: 150px;">Day</th>
                            <th>Open Time</th>
                            <th>Close Time</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="openHour, stat : *{openHours}">
                            <td>
                                <input type="hidden" th:field="*{openHours[__${stat.index}__].dayOfWeek}">
                                <span class="fw-bold" th:text="*{openHours[__${stat.index}__].dayOfWeek}">MONDAY</span>
                            </td>
                            <td>
                                <input type="time" class="form-control" th:field="*{openHours[__${stat.index}__].openTime}">
                            </td>
                            <td>
                                <input type="time" class="form-control" th:field="*{openHours[__${stat.index}__].closeTime}">
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="form-text text-muted">Leave times empty if the restaurant is closed on that day.</div>
                </div>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-primary-custom">Save Restaurant Details</button>
            </div>
        </form>

        <div th:if="${restaurant.id != null}">
            <hr class="my-5">

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="mb-0">Menu Items</h3>
                <a th:href="@{/owner/restaurant/{id}/menu/new(id=${restaurant.id})}" class="btn btn-success btn-sm">
                    <i class="bi bi-plus-lg"></i> Add Item
                </a>
            </div>

            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th class="text-end">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="item : ${restaurant.menu}">
                        <td class="fw-bold" th:text="${item.name}">Burger</td>
                        <td class="text-muted small" th:text="${item.description}">Desc</td>
                        <td th:text="${item.price} + '€'">10€</td>
                        <td>
                            <span th:if="${item.available}" class="badge bg-success">Available</span>
                            <span th:unless="${item.available}" class="badge bg-danger">Sold Out</span>
                        </td>
                        <td class="text-end">
                            <a th:href="@{/owner/restaurant/{rid}/menu/{mid}/edit(rid=${restaurant.id}, mid=${item.id})}"
                               class="btn btn-sm btn-outline-primary me-1">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a th:href="@{/owner/restaurant/{rid}/menu/{mid}/delete(rid=${restaurant.id}, mid=${item.id})}"
                               class="btn btn-sm btn-outline-danger"
                               onclick="return confirm('Delete this item?');">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                    <tr th:if="${restaurant.menu.isEmpty()}">
                        <td colspan="5" class="text-center text-muted py-3">No menu items yet.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>